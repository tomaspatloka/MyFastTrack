<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MyFastTrack Ultimate</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e1e1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Ikony a Fonty -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
        rel="stylesheet">

    <!-- Knihovna pro Grafy -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Styly -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="dark-mode">
    <div class="app-container">

        <!-- HLAVIƒåKA -->
        <header class="app-bar">
            <div class="app-title-wrapper">
                <span class="material-symbols-outlined app-logo">bolt</span>
                <h1 class="app-title">MyFastTrack</h1>
            </div>
            <div class="header-actions">
                <span class="material-symbols-outlined status-icon" id="syncStatusIcon" title="Offline">cloud_off</span>
                <div class="user-badge" id="headerWeight"
                    onclick="window.switchTab('weight', document.getElementById('tab-weight'))">-- kg</div>
                <button class="icon-btn" onclick="window.switchTab('settings', null)">
                    <span class="material-symbols-outlined">settings</span>
                </button>
            </div>
        </header>

        <main class="main-content">

            <!-- 1. DASHBOARD -->
            <div id="view-dashboard" class="view-section">
                <div class="card text-center" id="dashboardCard">
                    <div class="status-chip" id="statusBadge">Naƒç√≠t√°n√≠...</div>

                    <div class="timer-wrapper">
                        <svg class="timer-svg" viewBox="0 0 100 100">
                            <circle class="timer-bg" cx="50" cy="50" r="45"></circle>
                            <circle class="timer-progress" id="timerCircle" cx="50" cy="50" r="45"></circle>
                        </svg>
                        <div class="timer-text">
                            <span id="timerValue">--:--</span>
                            <small id="timerLabel">naƒç√≠t√°m</small>
                        </div>
                    </div>

                    <!-- F√°ze p≈Østu -->
                    <div id="fastingPhaseContainer" class="phase-container hidden">
                        <span class="material-symbols-outlined phase-icon">vital_signs</span>
                        <div class="phase-info">
                            <div class="phase-label">Aktu√°ln√≠ f√°ze</div>
                            <div class="phase-value" id="fastingPhaseText">--</div>
                        </div>
                    </div>

                    <p id="subTimerText" class="motivation-text">Discipl√≠na je svoboda.</p>
                </div>

                <!-- PITN√ù RE≈ΩIM -->
                <div class="card" id="waterCard"
                    style="display: flex; align-items: center; justify-content: space-between; padding: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="material-symbols-outlined text-primary">water_drop</span>
                        <div>
                            <div style="font-weight: bold; font-size: 1.1rem;">Voda</div>
                            <small id="waterAmount">0 l</small>
                        </div>
                    </div>
                    <div class="water-controls" style="display: flex; align-items: center; gap: 10px;">
                        <button class="icon-btn" onclick="updateWater(-1)"
                            style="background: rgba(255,255,255,0.1); width: 32px; height: 32px;">-</button>
                        <span id="waterCount"
                            style="font-size: 1.2rem; font-weight: bold; min-width: 20px; text-align: center;">0</span>
                        <button class="icon-btn" onclick="updateWater(1)"
                            style="background: var(--color-primary); color: #000; width: 32px; height: 32px;">+</button>
                    </div>
                </div>

                <!-- SOS Karta (zobraz√≠ se jen p≈ôi dlouh√©m p≈Østu) -->
                <div class="card sos-card hidden" id="sosCard">
                    <div class="card-header text-danger">
                        <span class="card-title"><span class="material-symbols-outlined">warning</span> KRIZE?</span>
                    </div>
                    <div class="sos-actions">
                        <div class="sos-item">üßÇ S≈Øl</div>
                        <div class="sos-item">üíß Voda</div>
                        <div class="sos-item">‚òï K√°va</div>
                    </div>
                </div>

                <!-- Odkaz na j√≠deln√≠ƒçek -->
                <div class="card" onclick="window.switchTab('recipes', document.getElementById('tab-recipes'))"
                    style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                    <span class="card-title" style="margin:0"><span class="material-symbols-outlined">menu_book</span>
                        J√≠deln√≠ƒçek</span>
                    <span class="material-symbols-outlined">chevron_right</span>
                </div>
            </div>

            <!-- 2. RECEPTY (14 DN√ç) -->
            <div id="view-recipes" class="view-section hidden">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 class="section-title">Pl√°n na 14 dn√≠</h3>
                    <button class="icon-btn" onclick="openMealEditor()" style="margin-right:10px;"><span
                            class="material-symbols-outlined">edit</span></button>
                </div>
                <div id="recipesContainer"></div>
                <div class="text-center" style="margin-top: 20px;">
                    <button onclick="resetMealPlan()" class="btn-text text-danger">Resetovat postup v j√≠dle</button>
                </div>
            </div>

            <!-- 3. V√ÅHA -->
            <div id="view-weight" class="view-section hidden">
                <div class="card">
                    <div class="card-header"><span class="card-title"><span
                                class="material-symbols-outlined">monitor_weight</span> Z√°znam v√°hy</span></div>
                    <form id="weightForm" class="weight-form">
                        <div class="input-group">
                            <input type="number" id="weightInput" step="0.1" placeholder="Kg" required>
                            <input type="date" id="dateInput" required>
                        </div>
                        <button type="submit" class="btn-primary">Ulo≈æit v√°hu</button>
                    </form>
                </div>

                <div class="stats-grid">
                    <div class="stat-box"><small>C√≠l</small><strong id="statTarget">--</strong></div>
                    <div class="stat-box"><small>Zb√Ωv√°</small><strong id="statRemaining">--</strong></div>
                    <div class="stat-box"><small>Zmƒõna</small><strong id="statTotal">--</strong></div>
                </div>

                <div class="card">
                    <div style="height: 250px;">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="clearWeightData()" class="btn-text text-danger">Smazat historii v√°≈æen√≠</button>
                </div>
            </div>

            <!-- 4. N√ÅKUP -->
            <div id="view-shopping" class="view-section hidden">
                <div class="card">
                    <div class="card-header">B√≠lkoviny</div>
                    <div id="shopList-protein"></div>
                </div>
                <div class="card">
                    <div class="card-header">Ostatn√≠</div>
                    <div id="shopList-vege"></div>
                </div>
            </div>

            <div class="text-center" style="margin-top: 15px;">
                <button onclick="exportShoppingList()" class="btn-primary"
                    style="display: inline-flex; align-items: center; gap: 8px;">
                    <span class="material-symbols-outlined">share</span> Sd√≠let n√°kup
                </button>
            </div>
    </div>

    <!-- 5. NASTAVEN√ç -->
    <div id="view-settings" class="view-section hidden">
        <h3 class="section-title">Nastaven√≠</h3>

        <div class="card">
            <h4 class="card-header">C√≠le</h4>
            <div class="form-group"><label>Startovn√≠ v√°ha (kg)</label><input type="number" id="cfgStartWeight"
                    class="form-input"></div>
            <div class="form-group"><label>C√≠lov√° v√°ha (kg)</label><input type="number" id="cfgTargetWeight"
                    class="form-input"></div>
        </div>

        <div class="card">
            <h4 class="card-header">Bƒõ≈æn√Ω den</h4>
            <div class="form-group">
                <label>Re≈æim p≈Østu</label>
                <select id="cfgFastingMode" class="form-input" onchange="updateFastingModeInputs()">
                    <option value="custom">Vlastn√≠</option>
                    <option value="16:8">16:8 (Klasika)</option>
                    <option value="18:6">18:6 (Pokroƒçil√Ω)</option>
                    <option value="20:4">20:4 (V√°leƒçn√≠k)</option>
                </select>
            </div>
            <div class="form-group"><label>Zaƒç√°tek j√≠dla</label><input type="time" id="cfgEatingStart"
                    class="form-input"></div>
            <div class="form-group"><label>Konec j√≠dla</label><input type="time" id="cfgEatingEnd" class="form-input">
            </div>
        </div>

        <div class="card">
            <h4 class="card-header">Dlouh√Ω p≈Øst</h4>
            <div class="form-group">
                <label>Den dlouh√©ho p≈Østu</label>
                <select id="cfgLongFastDay" class="form-input">
                    <option value="1">Pondƒõl√≠</option>
                    <option value="2">√öter√Ω</option>
                    <option value="3">St≈ôeda</option>
                    <option value="4">ƒåtvrtek</option>
                    <option value="5">P√°tek</option>
                    <option value="6">Sobota</option>
                    <option value="0">Nedƒõle</option>
                </select>
            </div>
            <div class="form-group"><label>D√©lka (hodin)</label><input type="number" id="cfgLongFastDuration"
                    class="form-input"></div>
        </div>

        <div class="card">
            <h4 class="card-header">Notifikace</h4>
            <div class="form-group" style="display:flex; justify-content:space-between; align-items:center;">
                <label style="margin:0">Upozornƒõn√≠ na p≈Øst</label>
                <button id="btnNotifications" class="btn-primary" style="padding: 6px 12px; font-size: 0.8rem;"
                    onclick="toggleNotifications()">Zapnout</button>
            </div>

            <button onclick="saveSettings()" class="btn-primary full-width">Ulo≈æit a aplikovat</button>
            <div class="text-center" style="margin-top:20px">
                <button onclick="factoryReset()" class="btn-text text-danger">Tov√°rn√≠ nastaven√≠</button>
            </div>
        </div>

        <div class="card hidden" id="pwaInstallCard">
            <h4 class="card-header">Aplikace</h4>
            <p style="margin-bottom: 10px; font-size: 0.9rem; color: #888;">Nainstalujte si MyFastTrack na plochu pro
                lep≈°√≠ z√°≈æitek.</p>
            <button id="pwaInstallBtn" class="btn-primary full-width">Instalovat aplikaci</button>
        </div>


        </main>

        <!-- MODAL: Editace J√≠dla -->
        <div id="mealEditModal" class="modal hidden">
            <div class="modal-content card">
                <h3>Upravit j√≠dlo</h3>
                <form id="mealEditForm">
                    <input type="hidden" id="editMealId">
                    <input type="hidden" id="editMealDay">

                    <div class="form-group">
                        <label>N√°zev j√≠dla</label>
                        <input type="text" id="editMealName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Porce</label>
                        <input type="text" id="editMealPortion" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Popis / Recept</label>
                        <textarea id="editMealDesc" class="form-input" rows="3"
                            style="font-family: inherit;"></textarea>
                    </div>

                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <button type="button" class="btn-text text-danger" onclick="closeMealEditor()">Zru≈°it</button>
                        <button type="submit" class="btn-primary" style="flex:1;">Ulo≈æit</button>
                    </div>
                </form>
            </div>
        </div>

        <nav class="tabs-container">
            <button class="tab active" onclick="window.switchTab('dashboard', this)"><span
                    class="material-symbols-outlined">timer</span><span>P≈Øst</span></button>
            <button class="tab" id="tab-recipes" onclick="window.switchTab('recipes', this)"><span
                    class="material-symbols-outlined">menu_book</span><span>Pl√°n</span></button>
            <button class="tab" id="tab-weight" onclick="window.switchTab('weight', this)"><span
                    class="material-symbols-outlined">show_chart</span><span>V√°ha</span></button>
            <button class="tab" onclick="window.switchTab('shopping', this)"><span
                    class="material-symbols-outlined">shopping_cart</span><span>N√°kup</span></button>
        </nav>

    </div>
    <script src="js/app.js"></script>
</body>

</html>